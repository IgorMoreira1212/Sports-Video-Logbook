@model IEnumerable<Sports_Video_Logbook.Models.Tarefa>

@{
    ViewData["Title"] = "Tarefas Atribuídas";
}

<div class="skills-card">
    <div class="skills-header">
        <form id="tarefaSearchForm" method="get" action="/Tarefas/Index" class="d-flex" style="width:100%;gap:10px;">
            <input id="searchTarefa" name="search" type="text" class="skills-search" placeholder="Pesquisar" value="@Context.Request.Query["search"]" autocomplete="off" />
            <select id="ucFilter" name="uc" class="skills-search">
                <option value="" selected="@(Context.Request.Query["uc"] == "" ? "selected" : null)">Todos</option>
                @foreach (var uc in ViewBag.UCsDisponiveis ?? new List<dynamic>())
                {
                    <option value="@uc.Id" selected="@(Context.Request.Query["uc"] == uc.Id.ToString() ? "selected" : null)">@uc.Nome</option>
                }
            </select>
        </form>
    </div>
    <table class="skills-table">
        <thead>
            <tr>
                <th class="skills-th">Tarefa</th>
                <th class="skills-th">Unidade Curricular</th>
                <th class="skills-th skills-th-action">Ação</th>
            </tr>
        </thead>
        <tbody id="tarefasList">
        @foreach (var item in Model) {
            <tr class="skill-row" data-uc-id="@item.UCId" data-turma="@item.TurmaNome">
                <td class="skills-td">@item.Titulo</td>
                <td class="skills-td">@(item.UC?.Nome ?? "N/A")</td>
                <td class="skills-td skills-td-action">
                    <a asp-action="Details" asp-route-id="@item.Id" class="skills-details-btn">DETALHES</a>
                    <form asp-action="Delete" asp-route-id="@item.Id" method="post" style="display:inline;">
                        <input type="hidden" name="Id" value="@item.Id" />
                        <button type="submit" class="skills-remove-btn" onclick="return confirm('Tem certeza que deseja remover esta tarefa?')">REMOVER</button>
                    </form>
                </td>
            </tr>
        }
        </tbody>
    </table>
</div>



@section Scripts {
<script>
    // Debounce function
    function debounce(func, wait) {
        let timeout;
        return function(...args) {
            clearTimeout(timeout);
            timeout = setTimeout(() => func.apply(this, args), wait);
        };
    }
    // Submit on search input
    const searchInput = document.getElementById('searchTarefa');
    const ucFilter = document.getElementById('ucFilter');
    const form = document.getElementById('tarefaSearchForm');
    if (searchInput) {
        searchInput.addEventListener('input', debounce(function() {
            form.submit();
        }, 400));
    }
    if (ucFilter) {
        ucFilter.addEventListener('change', function() {
            form.submit();
        });
    }
</script>
}
